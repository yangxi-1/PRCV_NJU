<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-33108845-1']);
  _gaq.push(['_setDomainName', 'opencv.org']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Saving and Loading a FaceRecognizer &mdash; OpenCV 2.4.13.7 documentation</title>
    <link rel="stylesheet" href="../../../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../',
        VERSION:     '2.4.13.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <link rel="top" title="OpenCV 2.4.13.7 documentation" href="../../../../../index.html" />
    <link rel="up" title="FaceRecognizer - Face Recognition with OpenCV" href="../index.html" />
    <link rel="next" title="ColorMaps in OpenCV" href="../colormaps.html" />
    <link rel="prev" title="Face Recognition in Videos with OpenCV" href="facerec_video_recognition.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../colormaps.html" title="ColorMaps in OpenCV"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="facerec_video_recognition.html" title="Face Recognition in Videos with OpenCV"
             accesskey="P">previous</a> |</li>
        <li><a href="../../../../../index.html">OpenCV 2.4.13.7 documentation</a> &raquo;</li>
          <li><a href="../../../../refman.html" >OpenCV API Reference</a> &raquo;</li>
          <li><a href="../../contrib.html" >contrib. Contributed/Experimental Stuff</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">FaceRecognizer - Face Recognition with OpenCV</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
  
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="saving-and-loading-a-facerecognizer">
<h1>Saving and Loading a FaceRecognizer<a class="headerlink" href="#saving-and-loading-a-facerecognizer" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Saving and loading a <a class="reference internal" href="../facerec_api.html#FaceRecognizer : public Algorithm" title="class FaceRecognizer : public Algorithm"><code class="xref ocv ocv-class docutils literal"><span class="pre">FaceRecognizer</span></code></a> is very important. Training a FaceRecognizer can be a very time-intense task, plus it&#8217;s often impossible to ship the whole face database to the user of your product. The task of saving and loading a FaceRecognizer is easy with <a class="reference internal" href="../facerec_api.html#FaceRecognizer : public Algorithm" title="class FaceRecognizer : public Algorithm"><code class="xref ocv ocv-class docutils literal"><span class="pre">FaceRecognizer</span></code></a>. You only have to call <a class="reference internal" href="../facerec_api.html#void FaceRecognizer::load(const string&amp; filename)" title="void FaceRecognizer::load(const string&amp; filename)"><code class="xref ocv ocv-func docutils literal"><span class="pre">FaceRecognizer::load()</span></code></a> for loading and <a class="reference internal" href="../facerec_api.html#void FaceRecognizer::save(const string&amp; filename) const" title="void FaceRecognizer::save(const string&amp; filename) const"><code class="xref ocv ocv-func docutils literal"><span class="pre">FaceRecognizer::save()</span></code></a> for saving a <a class="reference internal" href="../facerec_api.html#FaceRecognizer : public Algorithm" title="class FaceRecognizer : public Algorithm"><code class="xref ocv ocv-class docutils literal"><span class="pre">FaceRecognizer</span></code></a>.</p>
<p>I&#8217;ll adapt the Eigenfaces example from the <a class="reference internal" href="../facerec_tutorial.html"><em>Face Recognition with OpenCV</em></a>: Imagine we want to learn the Eigenfaces of the <a class="reference external" href="http://www.cl.cam.ac.uk/research/dtg/attarchive/facedatabase.html">AT&amp;T Facedatabase</a>, store the model to a YAML file and then load it again.</p>
<p>From the loaded model, we&#8217;ll get a prediction, show the mean, Eigenfaces and the image reconstruction.</p>
</div>
<div class="section" id="using-facerecognizer-save-and-facerecognizer-load">
<h2>Using FaceRecognizer::save and FaceRecognizer::load<a class="headerlink" href="#using-facerecognizer-save-and-facerecognizer-load" title="Permalink to this headline">¶</a></h2>
<p>The source code for this demo application is also available in the <code class="docutils literal"><span class="pre">src</span></code> folder coming with this documentation:</p>
<ul class="simple">
<li><a class="reference download internal" href="../../../../../_downloads/facerec_save_load.cpp" download=""><code class="xref download docutils literal"><span class="pre">src/facerec_save_load.cpp</span></code></a></li>
</ul>
<div class="highlight-cpp"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200</pre></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2011. Philipp Wagner &lt;bytefish[at]gmx[dot]de&gt;.</span>
<span class="cm"> * Released to public domain under terms of the BSD Simplified license.</span>
<span class="cm"> *</span>
<span class="cm"> * Redistribution and use in source and binary forms, with or without</span>
<span class="cm"> * modification, are permitted provided that the following conditions are met:</span>
<span class="cm"> *   * Redistributions of source code must retain the above copyright</span>
<span class="cm"> *     notice, this list of conditions and the following disclaimer.</span>
<span class="cm"> *   * Redistributions in binary form must reproduce the above copyright</span>
<span class="cm"> *     notice, this list of conditions and the following disclaimer in the</span>
<span class="cm"> *     documentation and/or other materials provided with the distribution.</span>
<span class="cm"> *   * Neither the name of the organization nor the names of its contributors</span>
<span class="cm"> *     may be used to endorse or promote products derived from this software</span>
<span class="cm"> *     without specific prior written permission.</span>
<span class="cm"> *</span>
<span class="cm"> *   See &lt;http://www.opensource.org/licenses/bsd-license&gt;</span>
<span class="cm"> */</span>

<span class="cp">#include</span> <span class="cpf">&quot;opencv2/contrib/contrib.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;opencv2/core/core.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;opencv2/highgui/highgui.hpp&quot;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sstream&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">static</span> <span class="n">Mat</span> <span class="nf">norm_0_255</span><span class="p">(</span><span class="n">InputArray</span> <span class="n">_src</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Mat</span> <span class="n">src</span> <span class="o">=</span> <span class="n">_src</span><span class="p">.</span><span class="n">getMat</span><span class="p">();</span>
    <span class="c1">// Create and return normalized image:</span>
    <span class="n">Mat</span> <span class="n">dst</span><span class="p">;</span>
    <span class="k">switch</span><span class="p">(</span><span class="n">src</span><span class="p">.</span><span class="n">channels</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
        <span class="n">cv</span><span class="o">::</span><span class="n">normalize</span><span class="p">(</span><span class="n">_src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">NORM_MINMAX</span><span class="p">,</span> <span class="n">CV_8UC1</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
        <span class="n">cv</span><span class="o">::</span><span class="n">normalize</span><span class="p">(</span><span class="n">_src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">NORM_MINMAX</span><span class="p">,</span> <span class="n">CV_8UC3</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
        <span class="n">src</span><span class="p">.</span><span class="n">copyTo</span><span class="p">(</span><span class="n">dst</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">dst</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">read_csv</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">filename</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Mat</span><span class="o">&gt;&amp;</span> <span class="n">images</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">labels</span><span class="p">,</span> <span class="kt">char</span> <span class="n">separator</span> <span class="o">=</span> <span class="sc">&#39;;&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">ifstream</span> <span class="n">file</span><span class="p">(</span><span class="n">filename</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">ifstream</span><span class="o">::</span><span class="n">in</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">file</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">string</span> <span class="n">error_message</span> <span class="o">=</span> <span class="s">&quot;No valid input file was given, please check the given filename.&quot;</span><span class="p">;</span>
        <span class="n">CV_Error</span><span class="p">(</span><span class="n">CV_StsBadArg</span><span class="p">,</span> <span class="n">error_message</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">string</span> <span class="n">line</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">classlabel</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">getline</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">stringstream</span> <span class="n">liness</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
        <span class="n">getline</span><span class="p">(</span><span class="n">liness</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">separator</span><span class="p">);</span>
        <span class="n">getline</span><span class="p">(</span><span class="n">liness</span><span class="p">,</span> <span class="n">classlabel</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">path</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">classlabel</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">images</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">imread</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
            <span class="n">labels</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">atoi</span><span class="p">(</span><span class="n">classlabel</span><span class="p">.</span><span class="n">c_str</span><span class="p">()));</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="c1">// Check for valid command line arguments, print usage</span>
    <span class="c1">// if no arguments were given.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;usage: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &lt;csv.ext&gt; &lt;output_folder&gt; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">string</span> <span class="n">output_folder</span> <span class="o">=</span> <span class="s">&quot;.&quot;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">output_folder</span> <span class="o">=</span> <span class="n">string</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="c1">// Get the path to your CSV.</span>
    <span class="n">string</span> <span class="n">fn_csv</span> <span class="o">=</span> <span class="n">string</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="c1">// These vectors hold the images and corresponding labels.</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">Mat</span><span class="o">&gt;</span> <span class="n">images</span><span class="p">;</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">labels</span><span class="p">;</span>
    <span class="c1">// Read in the data. This can fail if no valid</span>
    <span class="c1">// input filename is given.</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="n">read_csv</span><span class="p">(</span><span class="n">fn_csv</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Exception</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Error opening file </span><span class="se">\&quot;</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">fn_csv</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\&quot;</span><span class="s">. Reason: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">msg</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="c1">// nothing more we can do</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Quit if there are not enough images for this demo.</span>
    <span class="k">if</span><span class="p">(</span><span class="n">images</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">string</span> <span class="n">error_message</span> <span class="o">=</span> <span class="s">&quot;This demo needs at least 2 images to work. Please add more images to your data set!&quot;</span><span class="p">;</span>
        <span class="n">CV_Error</span><span class="p">(</span><span class="n">CV_StsError</span><span class="p">,</span> <span class="n">error_message</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Get the height from the first image. We&#39;ll need this</span>
    <span class="c1">// later in code to reshape the images to their original</span>
    <span class="c1">// size:</span>
    <span class="kt">int</span> <span class="n">height</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">rows</span><span class="p">;</span>
    <span class="c1">// The following lines simply get the last images from</span>
    <span class="c1">// your dataset and remove it from the vector. This is</span>
    <span class="c1">// done, so that the training data (which we learn the</span>
    <span class="c1">// cv::FaceRecognizer on) and the test data we test</span>
    <span class="c1">// the model with, do not overlap.</span>
    <span class="n">Mat</span> <span class="n">testSample</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="n">images</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">testLabel</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">labels</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
    <span class="n">images</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
    <span class="n">labels</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
    <span class="c1">// The following lines create an Eigenfaces model for</span>
    <span class="c1">// face recognition and train it with the images and</span>
    <span class="c1">// labels read from the given CSV file.</span>
    <span class="c1">// This here is a full PCA, if you just want to keep</span>
    <span class="c1">// 10 principal components (read Eigenfaces), then call</span>
    <span class="c1">// the factory method like this:</span>
    <span class="c1">//</span>
    <span class="c1">//      cv::createEigenFaceRecognizer(10);</span>
    <span class="c1">//</span>
    <span class="c1">// If you want to create a FaceRecognizer with a</span>
    <span class="c1">// confidence threshold (e.g. 123.0), call it with:</span>
    <span class="c1">//</span>
    <span class="c1">//      cv::createEigenFaceRecognizer(10, 123.0);</span>
    <span class="c1">//</span>
    <span class="c1">// If you want to use _all_ Eigenfaces and have a threshold,</span>
    <span class="c1">// then call the method like this:</span>
    <span class="c1">//</span>
    <span class="c1">//      cv::createEigenFaceRecognizer(0, 123.0);</span>
    <span class="c1">//</span>
    <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">FaceRecognizer</span><span class="o">&gt;</span> <span class="n">model0</span> <span class="o">=</span> <span class="n">createEigenFaceRecognizer</span><span class="p">();</span>
    <span class="n">model0</span><span class="o">-&gt;</span><span class="n">train</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">);</span>
    <span class="c1">// save the model to eigenfaces_at.yaml</span>
    <span class="n">model0</span><span class="o">-&gt;</span><span class="n">save</span><span class="p">(</span><span class="s">&quot;eigenfaces_at.yml&quot;</span><span class="p">);</span>
    <span class="c1">//</span>
    <span class="c1">//</span>
    <span class="c1">// Now create a new Eigenfaces Recognizer</span>
    <span class="c1">//</span>
    <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">FaceRecognizer</span><span class="o">&gt;</span> <span class="n">model1</span> <span class="o">=</span> <span class="n">createEigenFaceRecognizer</span><span class="p">();</span>
    <span class="n">model1</span><span class="o">-&gt;</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;eigenfaces_at.yml&quot;</span><span class="p">);</span>
    <span class="c1">// The following line predicts the label of a given</span>
    <span class="c1">// test image:</span>
    <span class="kt">int</span> <span class="n">predictedLabel</span> <span class="o">=</span> <span class="n">model1</span><span class="o">-&gt;</span><span class="n">predict</span><span class="p">(</span><span class="n">testSample</span><span class="p">);</span>
    <span class="c1">//</span>
    <span class="c1">// To get the confidence of a prediction call the model with:</span>
    <span class="c1">//</span>
    <span class="c1">//      int predictedLabel = -1;</span>
    <span class="c1">//      double confidence = 0.0;</span>
    <span class="c1">//      model-&gt;predict(testSample, predictedLabel, confidence);</span>
    <span class="c1">//</span>
    <span class="n">string</span> <span class="n">result_message</span> <span class="o">=</span> <span class="n">format</span><span class="p">(</span><span class="s">&quot;Predicted class = %d / Actual class = %d.&quot;</span><span class="p">,</span> <span class="n">predictedLabel</span><span class="p">,</span> <span class="n">testLabel</span><span class="p">);</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">result_message</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="c1">// Here is how to get the eigenvalues of this Eigenfaces model:</span>
    <span class="n">Mat</span> <span class="n">eigenvalues</span> <span class="o">=</span> <span class="n">model1</span><span class="o">-&gt;</span><span class="n">getMat</span><span class="p">(</span><span class="s">&quot;eigenvalues&quot;</span><span class="p">);</span>
    <span class="c1">// And we can do the same to display the Eigenvectors (read Eigenfaces):</span>
    <span class="n">Mat</span> <span class="n">W</span> <span class="o">=</span> <span class="n">model1</span><span class="o">-&gt;</span><span class="n">getMat</span><span class="p">(</span><span class="s">&quot;eigenvectors&quot;</span><span class="p">);</span>
    <span class="c1">// Get the sample mean from the training data</span>
    <span class="n">Mat</span> <span class="n">mean</span> <span class="o">=</span> <span class="n">model1</span><span class="o">-&gt;</span><span class="n">getMat</span><span class="p">(</span><span class="s">&quot;mean&quot;</span><span class="p">);</span>
    <span class="c1">// Display or save:</span>
    <span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">imshow</span><span class="p">(</span><span class="s">&quot;mean&quot;</span><span class="p">,</span> <span class="n">norm_0_255</span><span class="p">(</span><span class="n">mean</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">rows</span><span class="p">)));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">imwrite</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;%s/mean.png&quot;</span><span class="p">,</span> <span class="n">output_folder</span><span class="p">.</span><span class="n">c_str</span><span class="p">()),</span> <span class="n">norm_0_255</span><span class="p">(</span><span class="n">mean</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">rows</span><span class="p">)));</span>
    <span class="p">}</span>
    <span class="c1">// Display or save the Eigenfaces:</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">min</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">W</span><span class="p">.</span><span class="n">cols</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">string</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">format</span><span class="p">(</span><span class="s">&quot;Eigenvalue #%d = %.5f&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">eigenvalues</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">msg</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="c1">// get eigenvector #i</span>
        <span class="n">Mat</span> <span class="n">ev</span> <span class="o">=</span> <span class="n">W</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">clone</span><span class="p">();</span>
        <span class="c1">// Reshape to original size &amp; normalize to [0...255] for imshow.</span>
        <span class="n">Mat</span> <span class="n">grayscale</span> <span class="o">=</span> <span class="n">norm_0_255</span><span class="p">(</span><span class="n">ev</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">height</span><span class="p">));</span>
        <span class="c1">// Show the image &amp; apply a Jet colormap for better sensing.</span>
        <span class="n">Mat</span> <span class="n">cgrayscale</span><span class="p">;</span>
        <span class="n">applyColorMap</span><span class="p">(</span><span class="n">grayscale</span><span class="p">,</span> <span class="n">cgrayscale</span><span class="p">,</span> <span class="n">COLORMAP_JET</span><span class="p">);</span>
        <span class="c1">// Display or save:</span>
        <span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">imshow</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;eigenface_%d&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="n">cgrayscale</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">imwrite</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;%s/eigenface_%d.png&quot;</span><span class="p">,</span> <span class="n">output_folder</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">i</span><span class="p">),</span> <span class="n">norm_0_255</span><span class="p">(</span><span class="n">cgrayscale</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// Display or save the image reconstruction at some predefined steps:</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">num_components</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">num_components</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">;</span> <span class="n">num_components</span><span class="o">+=</span><span class="mi">15</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// slice the eigenvectors from the model</span>
        <span class="n">Mat</span> <span class="n">evs</span> <span class="o">=</span> <span class="n">Mat</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">Range</span><span class="o">::</span><span class="n">all</span><span class="p">(),</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_components</span><span class="p">));</span>
        <span class="n">Mat</span> <span class="n">projection</span> <span class="o">=</span> <span class="n">subspaceProject</span><span class="p">(</span><span class="n">evs</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
        <span class="n">Mat</span> <span class="n">reconstruction</span> <span class="o">=</span> <span class="n">subspaceReconstruct</span><span class="p">(</span><span class="n">evs</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">projection</span><span class="p">);</span>
        <span class="c1">// Normalize the result:</span>
        <span class="n">reconstruction</span> <span class="o">=</span> <span class="n">norm_0_255</span><span class="p">(</span><span class="n">reconstruction</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">rows</span><span class="p">));</span>
        <span class="c1">// Display or save:</span>
        <span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">imshow</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;eigenface_reconstruction_%d&quot;</span><span class="p">,</span> <span class="n">num_components</span><span class="p">),</span> <span class="n">reconstruction</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">imwrite</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;%s/eigenface_reconstruction_%d.png&quot;</span><span class="p">,</span> <span class="n">output_folder</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">num_components</span><span class="p">),</span> <span class="n">reconstruction</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// Display if we are not writing to an output folder:</span>
    <span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="results">
<h2>Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">eigenfaces_at.yml</span></code> then contains the model state, we&#8217;ll simply look at the first 10 lines with <code class="docutils literal"><span class="pre">head</span> <span class="pre">eigenfaces_at.yml</span></code>:</p>
<div class="highlight-none"><div class="highlight"><pre>philipp@mango:~/github/libfacerec-build$ head eigenfaces_at.yml
%YAML:1.0
num_components: 399
mean: !!opencv-matrix
   rows: 1
   cols: 10304
   dt: d
   data: [ 8.5558897243107765e+01, 8.5511278195488714e+01,
       8.5854636591478695e+01, 8.5796992481203006e+01,
       8.5952380952380949e+01, 8.6162907268170414e+01,
       8.6082706766917283e+01, 8.5776942355889716e+01,
</pre></div>
</div>
<p>And here is the Reconstruction, which is the same as the original:</p>
<img alt="../../../../../_images/eigenface_reconstruction_opencv1.png" class="align-center" src="../../../../../_images/eigenface_reconstruction_opencv1.png" />
</div>
</div>


          </div>
          <div class="feedback">
              <h2>Help and Feedback</h2>
              You did not find what you were looking for?
              <ul>
                  
                  
                  
                  <li>Ask a question on the <a href="http://answers.opencv.org">Q&A forum</a>.</li>
                  <li>If you think something is missing or wrong in the documentation,
                  please file a <a href="http://code.opencv.org">bug report</a>.</li>
              </ul>
          </div>
        </div>
      </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../../index.html">
              <img class="logo" src="../../../../../_static/opencv-logo-white.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
      <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Search" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
      </p>
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <h3><a href="../../../../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Saving and Loading a FaceRecognizer</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#using-facerecognizer-save-and-facerecognizer-load">Using FaceRecognizer::save and FaceRecognizer::load</a></li>
<li><a class="reference internal" href="#results">Results</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="facerec_video_recognition.html"
                        title="previous chapter">Face Recognition in Videos with OpenCV</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../colormaps.html"
                        title="next chapter">ColorMaps in OpenCV</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../../../_sources/modules/contrib/doc/facerec/tutorial/facerec_save_load.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../colormaps.html" title="ColorMaps in OpenCV"
             >next</a> |</li>
        <li class="right" >
          <a href="facerec_video_recognition.html" title="Face Recognition in Videos with OpenCV"
             >previous</a> |</li>
        <li><a href="../../../../../index.html">OpenCV 2.4.13.7 documentation</a> &raquo;</li>
          <li><a href="../../../../refman.html" >OpenCV API Reference</a> &raquo;</li>
          <li><a href="../../contrib.html" >contrib. Contributed/Experimental Stuff</a> &raquo;</li>
          <li><a href="../index.html" >FaceRecognizer - Face Recognition with OpenCV</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011-2014, opencv dev team.
      Last updated on Jul 12, 2018.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.6.
    </div>
  </body>
</html>